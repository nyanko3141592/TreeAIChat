# AIチャットアプリ 仕様書

## 概要
- ブラウザ上で動作するAIチャットアプリ。
- Gemini APIを利用し、ユーザー自身がAPIキーを入力して利用可能。
- 会話がツリー状に分岐できる独自UI。

## 機能要件
### 1. チャット機能
- ユーザーがテキストで質問（プロンプト）を入力し、AIが応答する。
- AIの応答、ユーザーの質問を問わず、**あらゆる会話ノード**から複数の分岐（ツリー構造）を**無限に**作成可能です。これにより、あるAIの応答に対して複数の異なる質問を試したり、ある質問に対してAIに複数の異なる応答を生成させたりすることができます。
- 各ノードをクリックして選択し、そのノードを起点として新たな分岐（会話シナリオ）を**自由に追加**できます。
  - 親ノードがAIの場合、子のノードはユーザーの質問になる。
  - 親ノードがユーザーの場合、子のノードはAIの応答になる。
- 会話ツリーはインデント形式で視覚的に表示され、ノード間の関係が分かる。

### 2. APIキー管理
- 初回アクセス時、ユーザーにGemini APIキーの入力を求める。
- 入力したAPIキーはブラウザのローカルストレージに保存。
- APIキーはユーザーの端末内でのみ保持し、サーバーには送信しない。
- APIキーの再入力・削除も可能。

### 3. 会話ツリーの保存・復元
- 会話ツリーの状態をローカルストレージに自動保存。
- ユーザーは会話ツリーをエクスポート/インポートできる（JSON形式）。

### 4. UI/UX
- シンプルで直感的なUI。
- ノードの追加、削除、編集が容易。
- モバイル・PC両対応（レスポンシブデザイン）。
- 会話ツリーは、**明確な木構造（ツリービュー）**として視覚的に表示され、ノード間の親子関係や分岐が一目でわかるようにします。インデントや接続線などを用いて、階層構造を分かりやすく表現します。

## 非機能要件
- Gemini APIとの通信はHTTPSで行う。
  - https://ai.google.dev/gemini-api/docs?hl=ja
- APIキーや会話内容は外部サーバーに送信しない。
- パフォーマンス：1000ノード程度のツリーでも快適に操作可能。
- 日本語・英語対応（UIは日本語優先、将来的に多言語化も考慮）。

## 画面イメージ（テキスト）
- 画面上部：APIキー入力欄（未入力時のみ表示）、APIキー設定ボタン（設定済みの場合）
- メイン：会話ツリー表示エリア。**インタラクティブな木構造**で会話の全体像が表示されます。各ノードはクリックで選択でき、選択したノードを親として、新たなユーザーの質問を追加したり、AIに新しい応答を生成させたりすることで、会話を分岐させることができます。
- 画面下部：選択中ノードへの入力欄＋送信ボタン。
- サイドバー：エクスポート/インポート、会話履歴一覧


## データ構造例
- 会話ツリーは以下のようなJSONで管理
```json
{
  "id": "ai-root",
  "type": "ai",
  "text": "AIに質問してください",
  "children": [
    {
      "id": "user-1",
      "type": "user",
      "text": "最初の質問",
      "children": [
        {
          "id": "ai-1",
          "type": "ai",
          "text": "AIの返答1",
          "children": []
        }
      ]
    },
    {
      "id": "user-2",
      "type": "user",
      "text": "別の質問",
      "children": [
        {
          "id": "ai-2",
          "type": "ai",
          "text": "AIの返答2",
          "children": []
        }
      ]
    }
  ]
}
```

## 保存方法
- ローカルストレージに会話ツリー全体をJSONで保存。
- エクスポート/インポート時も同様のJSON形式を利用。

## その他
- サーバーレスで完結（静的Webアプリとしてデプロイ可能）。
- Gemini APIの利用制限やエラー時のハンドリングも考慮。